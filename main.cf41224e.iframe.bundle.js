(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"./.storybook/preview.js-generated-config-entry.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var preview_namespaceObject={};__webpack_require__.r(preview_namespaceObject),__webpack_require__.d(preview_namespaceObject,"parameters",(function(){return parameters}));var ClientApi=__webpack_require__("./node_modules/@storybook/client-api/dist/esm/ClientApi.js");const parameters={actions:{argTypesRegex:"^on[A-Z].*"}};function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.keys(preview_namespaceObject).forEach((function(key){var value=preview_namespaceObject[key];switch(key){case"args":return Object(ClientApi.d)(value);case"argTypes":return Object(ClientApi.b)(value);case"decorators":return value.forEach((function(decorator){return Object(ClientApi.f)(decorator,!1)}));case"loaders":return value.forEach((function(loader){return Object(ClientApi.g)(loader,!1)}));case"parameters":return Object(ClientApi.h)(function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},value),!1);case"argTypesEnhancers":return value.forEach((function(enhancer){return Object(ClientApi.c)(enhancer)}));case"argsEnhancers":return value.forEach((function(enhancer){return Object(ClientApi.e)(enhancer)}));case"render":return Object(ClientApi.i)(value);case"globals":case"globalTypes":var v={};return v[key]=value,Object(ClientApi.h)(v,!1);case"__namedExportsOrder":case"decorateStory":case"renderToDOM":return null;default:return console.log(key+" was not supported :( !")}}))},"./generated-stories-entry.js":function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js").configure)([__webpack_require__("./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.mdx)$"),__webpack_require__("./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.(js|jsx|ts|tsx))$")],module,!1)}).call(this,__webpack_require__("./node_modules/webpack/buildin/module.js")(module))},"./node_modules/tableschema/lib/profiles sync recursive ^\\.\\/.*\\.json$":function(module,exports,__webpack_require__){var map={"./geojson.json":"./node_modules/tableschema/lib/profiles/geojson.json","./table-schema.json":"./node_modules/tableschema/lib/profiles/table-schema.json","./topojson.json":"./node_modules/tableschema/lib/profiles/topojson.json"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./node_modules/tableschema/lib/profiles sync recursive ^\\.\\/.*\\.json$"},"./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.(js|jsx|ts|tsx))$":function(module,exports,__webpack_require__){var map={"./stories/App.stories.js":"./src/stories/App.stories.js","./stories/Metadata.stories.js":"./src/stories/Metadata.stories.js","./stories/SelectSchema.stories.js":"./src/stories/SelectSchema.stories.js"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.(js|jsx|ts|tsx))$"},"./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.mdx)$":function(module,exports,__webpack_require__){var map={"./stories/Introduction.stories.mdx":"./src/stories/Introduction.stories.mdx"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.mdx)$"},"./src/App.css":function(module,exports,__webpack_require__){},"./src/components/Metadata/Metadata.css":function(module,exports,__webpack_require__){},"./src/components/Metadata/index.jsx":function(module,__webpack_exports__,__webpack_require__){"use strict";var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),datapub__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./src/components/Metadata/Metadata.css"),__webpack_require__("./node_modules/datapub/dist/core.js"));const customFields=[{label:"Access Restriction",name:"restricted",input_type:"select",values:['{"level": "public"}','{"level": "private"}'],options:["Public","Private"]}],Metadata=_ref=>{let{metadata:metadata,handleChange:handleChange}=_ref;return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("h3",{className:"metadata-name"},metadata.path),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"metadata-form"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"metadata-input"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("label",{className:"metadata-label",htmlFor:"title"},"Title"),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("input",{className:"metadata-input__input",type:"text",name:"title",id:"title",value:metadata.title||metadata.name,onChange:handleChange})),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"metadata-input"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("label",{className:"metadata-label",htmlFor:"description"},"Description"),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("input",{className:"metadata-input__input",type:"text",name:"description",id:"description",value:metadata.description||"",onChange:handleChange})),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"metadata-input"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("label",{className:"metadata-label",htmlFor:"encoding"},"Encoding"),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("select",{className:"metadata-input__input",name:"encoding",id:"encoding",value:metadata.encoding||"",onChange:handleChange,required:!0},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{value:"",disabled:!0},"Select..."),datapub__WEBPACK_IMPORTED_MODULE_2__.encodeData.map((item=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{key:"format-".concat(item.value),value:item.value},item.label))))),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"metadata-input"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("label",{className:"metadata-label",htmlFor:"format"},"Format"),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("select",{className:"metadata-input__input",name:"format",id:"format",value:(metadata.format||"").toLowerCase(),onChange:handleChange,required:!0},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{value:"",disabled:!0},"Select..."),datapub__WEBPACK_IMPORTED_MODULE_2__.formatData.map((item=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{key:"format-".concat(item[0]),value:item[0].toLowerCase()},item[0]))))),customFields&&customFields.map((item=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{key:"metadata-custom-".concat(item.name),className:"metadata-input"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("label",{className:"metadata-label",htmlFor:"format"},item.label),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("select",{className:"metadata-input__input",name:item.name,id:item.name,value:metadata[item.name]||"",onChange:handleChange,required:!0},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{value:"",disabled:!0},"Select..."),item.options.map(((option,index)=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{key:"".concat(item.name,"-").concat(index),value:item.values[index]},option)))))))))};Metadata.__docgenInfo={description:"",methods:[],displayName:"Metadata",props:{metadata:{description:"",type:{name:"object"},required:!0},handleChange:{description:"",type:{name:"func"},required:!0}}},__webpack_exports__.a=Metadata,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Metadata/index.jsx"]={name:"Metadata",docgenInfo:Metadata.__docgenInfo,path:"src/components/Metadata/index.jsx"})},"./src/components/ProgressBar/ProgressBar.css":function(module,exports,__webpack_require__){},"./src/components/SelectSchema/index.js":function(module,__webpack_exports__,__webpack_require__){"use strict";var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);const SelectSchema=_ref=>{let{resources:resources,client:client,onSchemaSelected:onSchemaSelected}=_ref;const[selectedSchema,setSelectedSchema]=Object(react__WEBPACK_IMPORTED_MODULE_0__.useState)("");return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"app-form-field"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("label",{className:"metadata-label"},"Copy metadata information from existing resource"),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("select",{className:"app-form-field-input",value:selectedSchema,onChange:async event=>{const resourceId=event.target.value;setSelectedSchema(event.target.value),onSchemaSelected(resourceId)}},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{value:""},"Select..."),resources.map(((_ref2,index)=>{let{name:name,schema:schema,id:id}=_ref2;return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("option",{key:"select-schema-option-".concat(id,"-").concat(index),value:id,disabled:!schema},name," ",schema?"":"(no schema to copy)")}))))};SelectSchema.__docgenInfo={description:"",methods:[],displayName:"SelectSchema",props:{resources:{description:"",type:{name:"array"},required:!0},onSchemaSelected:{description:"",type:{name:"func"},required:!0}}},__webpack_exports__.a=SelectSchema,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/SelectSchema/index.js"]={name:"SelectSchema",docgenInfo:SelectSchema.__docgenInfo,path:"src/components/SelectSchema/index.js"})},"./src/components/Spinner/Spinner.css":function(module,exports,__webpack_require__){},"./src/stories/App.stories.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"AppNHS",(function(){return AppNHS}));var react=__webpack_require__("./node_modules/react/index.js"),react_default=__webpack_require__.n(react),lib=__webpack_require__("./node_modules/ckanClient/lib/index.js"),frictionless_ckan_mapper_js_lib=__webpack_require__("./node_modules/frictionless-ckan-mapper-js/lib/index.js"),frictionless_ckan_mapper_js_lib_default=__webpack_require__.n(frictionless_ckan_mapper_js_lib),uuid=__webpack_require__("./node_modules/uuid/index.js"),core=__webpack_require__("./node_modules/datapub/dist/core.js"),node=__webpack_require__("./node_modules/frictionless.js/dist/node/index.js");__webpack_require__("./src/components/ProgressBar/ProgressBar.css");const ProgressBar_ProgressBar=props=>{const[offset,setOffset]=Object(react.useState)(0),circleRef=Object(react.useRef)(null),{size:size,progress:progress,strokeWidth:strokeWidth,circleOneStroke:circleOneStroke,circleTwoStroke:circleTwoStroke,timeRemaining:timeRemaining}=props,center=size/2,radius=size/2-strokeWidth/2,circumference=2*Math.PI*radius;return Object(react.useEffect)((()=>{setOffset((100-progress)/100*circumference),circleRef.current.style="transition: stroke-dashoffset 850ms ease-in-out"}),[setOffset,progress,circumference,offset]),react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("svg",{className:"svg",width:size,height:size},react_default.a.createElement("circle",{className:"svg-circle-bg",stroke:circleOneStroke,cx:center,cy:center,r:radius,strokeWidth:strokeWidth}),react_default.a.createElement("circle",{className:"svg-circle",ref:circleRef,stroke:circleTwoStroke,cx:center,cy:center,r:radius,strokeWidth:strokeWidth,strokeDasharray:circumference,strokeDashoffset:offset}),react_default.a.createElement("text",{x:"".concat(center),y:"".concat(center+2),className:"svg-circle-text"},progress,"%")),timeRemaining>0&&react_default.a.createElement("span",{className:"time-remaining"},timeRemaining>60?"".concat(Math.floor(timeRemaining/60)," minute").concat(Math.floor(timeRemaining/60)>1?"s":""):"".concat(Math.floor(timeRemaining)," second").concat(timeRemaining>1?"s":"")," left"))};ProgressBar_ProgressBar.__docgenInfo={description:"",methods:[],displayName:"ProgressBar",props:{size:{description:"",type:{name:"number"},required:!0},progress:{description:"",type:{name:"number"},required:!0},strokeWidth:{description:"",type:{name:"number"},required:!0},circleOneStroke:{description:"",type:{name:"string"},required:!0},circleTwoStroke:{description:"",type:{name:"string"},required:!0}}};var components_ProgressBar=ProgressBar_ProgressBar;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ProgressBar/index.jsx"]={name:"ProgressBar",docgenInfo:ProgressBar_ProgressBar.__docgenInfo,path:"src/components/ProgressBar/index.jsx"});class Upload_Upload extends react_default.a.Component{constructor(props){super(props),this.onChangeHandler=async event=>{let{formattedSize:formattedSize,selectedFile:selectedFile}=this.state;const allowedFormats=["csv","tsv","xls","xlsx","zip","pdf","json","geojson"];if(event.target.files.length>0){selectedFile=event.target.files[0];const file=node.open(selectedFile);if(["csv","tsv","xls","xlsx"].includes(file.descriptor.format))try{await file.addSchema()}catch(e){console.warn(e)}if(!allowedFormats.includes(file.descriptor.format))return void this.setState({selectedFile:selectedFile,loaded:0,success:!1,fileExists:!1,error:"File format not supported"});formattedSize=function(bytes){let decimals=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===bytes)return"0 Bytes";const dm=decimals<0?0:decimals,i=Math.floor(Math.log(bytes)/Math.log(1e3));return parseFloat((bytes/Math.pow(1e3,i)).toFixed(dm))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}(file.size);let self=this;const hash=await file.hash("sha256",(progress=>{self.onHashProgress(progress)}));this.props.metadataHandler(Object.assign(file.descriptor,{hash:hash}))}this.setState({selectedFile:selectedFile,loaded:0,success:!1,fileExists:!1,error:!1,formattedSize:formattedSize}),await this.onClickHandler()},this.onHashProgress=progress=>{100===progress?this.setState({hashInProgress:!1}):this.setState({hashLoaded:progress,hashInProgress:!0})},this.onUploadProgress=progressEvent=>{this.onTimeRemaining(progressEvent.loaded),this.setState({loaded:progressEvent.loaded/progressEvent.total*100})},this.onTimeRemaining=progressLoaded=>{const kbps=progressLoaded/(((new Date).getTime()-this.state.start)/1e3)/1024,timeRemaining=(this.state.fileSize-progressLoaded)/kbps;this.setState({timeRemaining:timeRemaining/1e3})},this.onClickHandler=async()=>{const start=(new Date).getTime(),{selectedFile:selectedFile}=this.state,{client:client}=this.props,resource=node.open(selectedFile);this.setState({fileSize:resource.size,start:start,loading:!0}),this.props.handleUploadStatus({loading:!0,error:!1,success:!1}),client.pushBlob(resource,this.onUploadProgress).then((response=>{this.setState({success:!0,loading:!1,fileExists:!response,loaded:100}),this.props.handleUploadStatus({loading:!1,success:!0})})).catch((error=>{console.error("Upload failed with error: "+error),this.setState({error:!0,loading:!1}),this.props.handleUploadStatus({loading:!1,success:!1,error:!0})}))},this.state={datasetId:props.datasetId,selectedFile:null,fileSize:0,formattedSize:"0 KB",start:"",loaded:0,success:!1,error:!1,fileExists:!1,loading:!1,timeRemaining:0,hashInProgress:!1,hashLoaded:0}}render(){const{success:success,fileExists:fileExists,error:error,timeRemaining:timeRemaining,selectedFile:selectedFile,formattedSize:formattedSize,hashInProgress:hashInProgress}=this.state;return react_default.a.createElement("div",{className:"upload-area"},react_default.a.createElement(core.Choose,{onChangeHandler:this.onChangeHandler,onChangeUrl:event=>console.log("Get url:",event.target.value)}),react_default.a.createElement("div",{className:"upload-area__info"},hashInProgress&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("ul",{className:"upload-list"},react_default.a.createElement("li",{className:"list-item"},react_default.a.createElement("div",{className:"upload-list-item"},react_default.a.createElement("div",null,react_default.a.createElement("p",{className:"upload-file-name"},"Computing file hash...")),react_default.a.createElement("div",null,react_default.a.createElement(components_ProgressBar,{progress:Math.round(this.state.hashLoaded),size:100,strokeWidth:5,circleOneStroke:"#d9edfe",circleTwoStroke:"#7ea9e1"}))))))),react_default.a.createElement("div",{className:"upload-area__info"},selectedFile&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("ul",{className:"upload-list"},react_default.a.createElement("li",{className:"list-item"},react_default.a.createElement("div",{className:"upload-list-item"},react_default.a.createElement("div",null,react_default.a.createElement("p",{className:"upload-file-name"},"Uploading ",selectedFile.name),react_default.a.createElement("p",{className:"upload-file-size"},formattedSize)),react_default.a.createElement("div",null,react_default.a.createElement(components_ProgressBar,{progress:Math.round(this.state.loaded),size:100,strokeWidth:5,circleOneStroke:"#d9edfe",circleTwoStroke:"#7ea9e1",timeRemaining:timeRemaining}))))),react_default.a.createElement("h2",{className:"upload-message"},success&&!fileExists&&!error&&"File uploaded successfully",fileExists&&"File uploaded successfully",error&&"Upload failed ".concat("string"==typeof error?error:"")))))}}Upload_Upload.__docgenInfo={description:"",methods:[{name:"onChangeHandler",docblock:null,modifiers:["async"],params:[{name:"event",type:null}],returns:null},{name:"onHashProgress",docblock:null,modifiers:[],params:[{name:"progress",type:null}],returns:null},{name:"onUploadProgress",docblock:null,modifiers:[],params:[{name:"progressEvent",type:null}],returns:null},{name:"onTimeRemaining",docblock:null,modifiers:[],params:[{name:"progressLoaded",type:null}],returns:null},{name:"onClickHandler",docblock:null,modifiers:["async"],params:[],returns:null}],displayName:"Upload"};var components_Upload=Upload_Upload;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Upload/index.jsx"]={name:"Upload",docgenInfo:Upload_Upload.__docgenInfo,path:"src/components/Upload/index.jsx"});var SelectSchema=__webpack_require__("./src/components/SelectSchema/index.js"),Metadata=__webpack_require__("./src/components/Metadata/index.jsx");__webpack_require__("./src/components/Spinner/Spinner.css");const Spinner_Spinner=_ref=>{let{size:size}=_ref;return react_default.a.createElement("div",{className:"spinner",style:{height:size,width:size}})};Spinner_Spinner.__docgenInfo={description:"",methods:[],displayName:"Spinner"};var components_Spinner=Spinner_Spinner;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Spinner/index.jsx"]={name:"Spinner",docgenInfo:Spinner_Spinner.__docgenInfo,path:"src/components/Spinner/index.jsx"});__webpack_require__("./src/App.css");class App_ResourceEditor extends react_default.a.Component{constructor(props){super(props),this.handleChangeMetadata=event=>{const target=event.target,value=target.value,name=target.name;let resourceCopy=this.state.resource;resourceCopy[name]=value,this.setState({resource:resourceCopy})},this.handleSubmitMetadata=async()=>{const{resource:resource,client:client}=this.state;await this.createResource(resource);{let result=(await client.action("package_show",{id:this.state.datasetId})).result;"draft"===result.state&&(result.state="active",await client.action("package_update",result))}return window.location.href="/dataset/".concat(this.state.datasetId)},this.createResource=async resource=>{const{client:client}=this.state,{config:config}=this.props;this.setState({createUpdateLoading:!0});const{organizationId:organizationId,datasetId:datasetId,resourceId:resourceId}=config,{urlName:urlName}=resource;delete resource.urlName;const ckanResource=frictionless_ckan_mapper_js_lib_default.a.resourceFrictionlessToCkan(resource);let data={...ckanResource.sample};delete ckanResource.sample;let bqTableName=ckanResource.bq_table_name?ckanResource.bq_table_name:Object(uuid.v4)(),ckanResourceCopy={...ckanResource,package_id:this.state.datasetId,name:resource.name||resource.title,sha256:resource.hash,size:resource.size,lfs_prefix:"".concat(organizationId,"/").concat(datasetId),url:urlName,url_type:"upload",bq_table_name:(id=bqTableName,id.replace(/-/g,"")),sample:data};var id;if(resourceId){var _resource$name,_resource$format;if(ckanResourceCopy={...ckanResourceCopy,id:resourceId},!urlName)ckanResourceCopy.url="".concat(null==resource||null===(_resource$name=resource.name)||void 0===_resource$name?void 0:_resource$name.toLowerCase(),".").concat(null==resource||null===(_resource$format=resource.format)||void 0===_resource$format?void 0:_resource$format.toLowerCase());return await client.action("resource_update",ckanResourceCopy),window.location.href="/dataset/".concat(datasetId)}await client.action("resource_create",ckanResourceCopy).then((response=>{this.onChangeResourceId(response.result.id)}))},this.deleteResource=async()=>{const{resource:resource,client:client,datasetId:datasetId}=this.state;if(this.setState({deleteLoading:!0}),window.confirm("Are you sure to delete this resource?"))return await client.action("resource_delete",{id:resource.id}),window.location.href="/dataset/".concat(datasetId)},this.setLoading=isLoading=>{this.setState({ui:{...this.state.ui,loading:isLoading}})},this.handleUploadStatus=status=>{const{ui:ui}=this.state,newUiState={...ui,success:status.success,error:status.error,loading:status.loading};this.setState({ui:newUiState})},this.onChangeResourceId=resourceId=>{this.setState({resourceId:resourceId})},this.onSchemaSelected=async resourceId=>{this.setLoading(!0);const{sample:sample,schema:schema}=await this.getSchemaWithSample(resourceId);this.setLoading(!1),this.setState({resource:Object.assign(this.state.resource,{schema:schema,sample:sample})})},this.getSchemaWithSample=async resourceId=>{const{client:client}=this.state,resourceSchema=await client.action("resource_schema_show",{id:resourceId}),resourceSample=await client.action("resource_sample_show",{id:resourceId}),sample=[],schema=resourceSchema.result||{fields:[]};try{for(const property in resourceSample.result)sample.push(resourceSample.result[property])}catch(e){console.error(e)}return{schema:schema,sample:sample}},this.setResource=async resourceId=>{const{client:client}=this.state,{result:result}=await client.action("resource_show",{id:resourceId});let resourceCopy={...result,...await this.getSchemaWithSample(resourceId)};return this.setState({client:client,resourceId:resourceId,resource:resourceCopy,isResourceEdit:!0})},this.state={resources:[],datasetId:this.props.config.datasetId,resourceId:"",resource:this.props.resource||{},ui:{fileOrLink:"",uploadComplete:void 0,success:!1,error:!1,loading:!1},client:null,isResourceEdit:!1,createUpdateLoading:!1,deleteLoading:!1},this.metadataHandler=this.metadataHandler.bind(this)}async componentDidMount(){const{config:config}=this.props,{authToken:authToken,api:api,lfs:lfs,organizationId:organizationId,datasetId:datasetId,resourceId:resourceId}=config,client=new lib.Client("".concat(authToken),"".concat(organizationId),"".concat(datasetId),"".concat(api),"".concat(lfs)),{result:result}=await client.action("package_show",{id:datasetId}),resources=result.resources||[];this.setState({client:client,resources:resources}),resourceId&&this.setResource(resourceId)}metadataHandler(fileResource){let resource=this.extendResource(fileResource);this.setState({resource:resource})}extendResource(resource){let newResource={...resource};newResource.title=resource.name,newResource.urlName=resource.name,newResource.size=resource.size;const newName=resource.name.split(".")[0].toUpperCase();return newResource.name=newName,newResource.bq_table_name=newName,newResource}render(){const{success:success,loading:loading}=this.state.ui,{createUpdateLoading:createUpdateLoading,deleteLoading:deleteLoading}=this.state,LoadingButton=_ref=>{let{isLoading:isLoading,children:children,...props}=_ref;return react_default.a.createElement("button",props,react_default.a.createElement("div",{className:"spinner-button"},isLoading?react_default.a.createElement(components_Spinner,{size:18}):null,children))};return react_default.a.createElement("div",{className:"App"},react_default.a.createElement("form",{className:"upload-wrapper",onSubmit:event=>(event.preventDefault(),this.state.isResourceEdit?this.createResource(this.state.resource):this.handleSubmitMetadata())},react_default.a.createElement("div",{className:"upload-header"},react_default.a.createElement("h2",{className:"upload-header__title"},"Resource Editor")),react_default.a.createElement(components_Upload,{client:this.state.client,resource:this.state.resource,metadataHandler:this.metadataHandler,datasetId:this.state.datasetId,handleUploadStatus:this.handleUploadStatus,onChangeResourceId:this.onChangeResourceId}),react_default.a.createElement("div",{className:"upload-edit-area"},react_default.a.createElement(Metadata.a,{metadata:this.state.resource,handleChange:this.handleChangeMetadata}),react_default.a.createElement("div",{className:"app-form-grid app-divider"},react_default.a.createElement(SelectSchema.a,{resources:this.state.resources,onSchemaSelected:this.onSchemaSelected})),this.state.resource.schema&&Object.keys(this.state.resource.schema).length>0&&react_default.a.createElement(core.TableSchema,{schema:this.state.resource.schema,data:this.state.resource.sample||[]}),this.state.isResourceEdit?react_default.a.createElement("div",{className:"resource-edit-actions"},react_default.a.createElement(LoadingButton,{disabled:deleteLoading,type:"button",className:"btn btn-delete",onClick:this.deleteResource,isLoading:deleteLoading},"Delete"),react_default.a.createElement(LoadingButton,{disabled:createUpdateLoading,isLoading:createUpdateLoading,className:"btn"},"Update")):react_default.a.createElement(LoadingButton,{disabled:!success||createUpdateLoading,isLoading:createUpdateLoading,className:"btn"},"Save and Publish"))))}}App_ResourceEditor.defaultProps={config:{authToken:"be270cae-1c77-4853-b8c1-30b6cf5e9878",api:"http://localhost:5000",lfs:"http://localhost:5001",organizationId:"myorg",datasetId:"data-test-2"}},App_ResourceEditor.__docgenInfo={description:"",methods:[{name:"metadataHandler",docblock:null,modifiers:[],params:[{name:"fileResource",type:null}],returns:null},{name:"extendResource",docblock:"Adds a new field bq_table_name to resources and formats name property\n@param {Object} resource",modifiers:[],params:[{name:"resource",description:null,type:{name:"Object"},optional:!1}],returns:null,description:"Adds a new field bq_table_name to resources and formats name property"},{name:"handleChangeMetadata",docblock:null,modifiers:[],params:[{name:"event",type:null}],returns:null},{name:"handleSubmitMetadata",docblock:null,modifiers:["async"],params:[],returns:null},{name:"createResource",docblock:null,modifiers:["async"],params:[{name:"resource",type:null}],returns:null},{name:"deleteResource",docblock:null,modifiers:["async"],params:[],returns:null},{name:"setLoading",docblock:null,modifiers:[],params:[{name:"isLoading",type:null}],returns:null},{name:"handleUploadStatus",docblock:null,modifiers:[],params:[{name:"status",type:null}],returns:null},{name:"onChangeResourceId",docblock:null,modifiers:[],params:[{name:"resourceId",type:null}],returns:null},{name:"onSchemaSelected",docblock:null,modifiers:["async"],params:[{name:"resourceId",type:null}],returns:null},{name:"getSchemaWithSample",docblock:null,modifiers:["async"],params:[{name:"resourceId",type:null}],returns:null},{name:"setResource",docblock:null,modifiers:["async"],params:[{name:"resourceId",type:null}],returns:null}],displayName:"ResourceEditor",props:{config:{defaultValue:{value:'{\n  authToken: "be270cae-1c77-4853-b8c1-30b6cf5e9878",\n  api: "http://localhost:5000",\n  lfs: "http://localhost:5001", // Feel free to modify this\n  organizationId: "myorg",\n  datasetId: "data-test-2",\n}',computed:!1},description:"",type:{name:"object"},required:!1}}};var src_App=App_ResourceEditor;"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/App.js"]={name:"ResourceEditor",docgenInfo:App_ResourceEditor.__docgenInfo,path:"src/App.js"});__webpack_exports__.default={title:"Templates",component:src_App};const AppNHS=()=>react_default.a.createElement(src_App,{config:{}});AppNHS.parameters={storySource:{source:"() => <App config={{}} />"},...AppNHS.parameters},AppNHS.__docgenInfo={description:"",methods:[],displayName:"AppNHS"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/stories/App.stories.js"]={name:"AppNHS",docgenInfo:AppNHS.__docgenInfo,path:"src/stories/App.stories.js"})},"./src/stories/Introduction.stories.mdx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"__page",(function(){return __page}));__webpack_require__("./node_modules/react/index.js");var _mdx_js_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@mdx-js/react/dist/esm.js"),_storybook_addon_docs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@storybook/addon-docs/dist/esm/index.js"),_storybook_addon_docs_blocks__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@storybook/addon-docs/blocks.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const layoutProps={};function MDXContent({components:components,...props}){return Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)("wrapper",_extends({},layoutProps,props,{components:components,mdxType:"MDXLayout"}),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)(_storybook_addon_docs_blocks__WEBPACK_IMPORTED_MODULE_3__.a,{title:"Example/Introduction",mdxType:"Meta"}),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)("h1",{id:"datapub-nhs"},"Datapub-nhs"),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)("p",null,"NHS data publishing app in React using DataPub.js framework."))}MDXContent.isMDXComponent=!0;const __page=()=>{throw new Error("Docs-only story")};__page.parameters={docsOnly:!0};const componentMeta={title:"Example/Introduction",includeStories:["__page"]},mdxStoryNameToKey={};componentMeta.parameters=componentMeta.parameters||{},componentMeta.parameters.docs={...componentMeta.parameters.docs||{},page:()=>Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)(_storybook_addon_docs__WEBPACK_IMPORTED_MODULE_2__.a,{mdxStoryNameToKey:mdxStoryNameToKey,mdxComponentAnnotations:componentMeta},Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.b)(MDXContent,null))},__webpack_exports__.default=componentMeta},"./src/stories/Metadata.stories.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Idle",(function(){return Idle})),__webpack_require__.d(__webpack_exports__,"Loading",(function(){return Loading})),__webpack_require__.d(__webpack_exports__,"Success",(function(){return Success}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/addon-actions/dist/esm/index.js"),_components_Metadata__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/Metadata/index.jsx");__webpack_exports__.default={title:"Components /Metadata",component:_components_Metadata__WEBPACK_IMPORTED_MODULE_2__.a,argTypes:{loading:{control:"boolean"}}};const Template=args=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_Metadata__WEBPACK_IMPORTED_MODULE_2__.a,args),Idle=Template.bind({});Idle.args={metadata:{title:"",description:"",encoding:"",path:"",format:"",license:""},handleChange:Object(_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("change value"),handleSubmit:Object(_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("submit form"),uploadSuccess:!1};const Loading=Template.bind({});Loading.args={...Idle.args};const Success=Template.bind({});Success.args={...Idle.args,uploadSuccess:!0},Idle.parameters={storySource:{source:"(args) => <Metadata {...args} />"},...Idle.parameters},Loading.parameters={storySource:{source:"(args) => <Metadata {...args} />"},...Loading.parameters},Success.parameters={storySource:{source:"(args) => <Metadata {...args} />"},...Success.parameters}},"./src/stories/SelectSchema.stories.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SelectSchemaStory",(function(){return SelectSchemaStory}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/addon-actions/dist/esm/index.js"),_components_SelectSchema__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/SelectSchema/index.js");__webpack_exports__.default={title:"Components /SelectSchema",component:_components_SelectSchema__WEBPACK_IMPORTED_MODULE_2__.a,argTypes:{resources:{control:{type:"select",options:[]}},onSchemaSelected:{action:"clicked"}}};const SelectSchemaStory=(args=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_SelectSchema__WEBPACK_IMPORTED_MODULE_2__.a,args)).bind({});SelectSchemaStory.args={resources:[{name:"sample1.csv",id:"sample-id1",schema:"{}"},{name:"sample2.csv",id:"sample-id2"}],onSchemaSelected:Object(_storybook_addon_actions__WEBPACK_IMPORTED_MODULE_1__.action)("sample.csv")},SelectSchemaStory.parameters={storySource:{source:"(args) => <SelectSchema {...args} />"},...SelectSchemaStory.parameters}},"./storybook-init-framework-entry.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js")},0:function(module,exports,__webpack_require__){__webpack_require__("./node_modules/@storybook/core-client/dist/esm/globals/polyfills.js"),__webpack_require__("./node_modules/@storybook/core-client/dist/esm/globals/globals.js"),__webpack_require__("./storybook-init-framework-entry.js"),__webpack_require__("./node_modules/@storybook/react/dist/esm/client/docs/config-generated-config-entry.js"),__webpack_require__("./node_modules/@storybook/react/dist/esm/client/preview/config-generated-config-entry.js"),__webpack_require__("./node_modules/@storybook/addon-links/preview.js-generated-config-entry.js"),__webpack_require__("./node_modules/@storybook/addon-docs/preview.js-generated-config-entry.js"),__webpack_require__("./node_modules/@storybook/addon-actions/preview.js-generated-config-entry.js"),__webpack_require__("./node_modules/@storybook/addon-backgrounds/preview.js-generated-config-entry.js"),__webpack_require__("./node_modules/@storybook/addon-measure/preview.js-generated-config-entry.js"),__webpack_require__("./node_modules/@storybook/addon-outline/preview.js-generated-config-entry.js"),__webpack_require__("./.storybook/preview.js-generated-config-entry.js"),module.exports=__webpack_require__("./generated-stories-entry.js")},1:function(module,exports){},10:function(module,exports){},11:function(module,exports){},12:function(module,exports){},13:function(module,exports){},14:function(module,exports){},15:function(module,exports){},16:function(module,exports){},17:function(module,exports){},18:function(module,exports){},19:function(module,exports){},2:function(module,exports){},20:function(module,exports){},3:function(module,exports){},4:function(module,exports){},5:function(module,exports){},6:function(module,exports){},7:function(module,exports){},8:function(module,exports){},9:function(module,exports){}},[[0,4,5]]]);